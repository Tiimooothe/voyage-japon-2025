<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Voyage Japon</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    font-family: sans-serif;
  }

  /* ===== Mobile-first par défaut ===== */
  #map {
    height: 60vh; /* 60% de la hauteur écran */
    width: 100%;
  }

  #planning {
    height: 40vh; /* 40% de la hauteur écran */
    overflow-y: auto;
    padding: 0.5em;
    background: #f8f8f8;
  }

  .day { margin-bottom: 1em; }
  .activity { cursor: pointer; margin: 0.2em 0; color: blue; text-decoration: underline; }

  /* ===== Desktop si écran large ===== */
  @media (min-width: 1024px) {
    body {
      display: flex;
      flex-direction: row;
      height: 100vh;
    }
    #map {
      width: 70%;
      height: 100%;
    }
    #planning {
      width: 30%;
      height: 100%;
    }
  }
</style>

</head>
<body>
  <div id="map"></div>
  <div id="planning" id="planning"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // ------------------------------
    // 1. Définir l'itinéraire ici
    // ------------------------------
    var itinerary = [
      {
        day: "Jour 2 - Mardi 16 septembre 2025 - Osaka",
        color: "blue",
        activities: [
          { name: "10h20 - Kansai International Airport", coords: [34.4342, 135.2444], description: "" },
          { name: "Quartier de Shinsekai", coords: [34.6525, 135.5067], description: "" },
          { name: "Déjeuner dans un restaurant local", coords: null, description: "" },
          { name: "Rue de Dotombori", coords: [34.6687, 135.5018], description: "" },
          { name: "Umeda Sky Building", coords: [34.7054, 135.4899], description: "" },
          { name: "19h00 : Diner et nuit à l'hôtel", coords: null, description: "" }
        ]
      },
      {
        day: "Jour 3 - Mercredi 17 septembre 2025 - Osaka",
        color: "green",
        activities: [
          { name: "Exposition universelle", coords: [34.8057, 135.5236], description: "" },
          { name: "Retour libre à l'hôtel", coords: null, description: "" },
          { name: "Diner et nuit à l'hôtel", coords: null, description: "" }
        ]
      },
      {
        day: "Jour 4 - Jeudi 18 septembre 2025 - Osaka / Nara / Kyoto",
        color: "yellow",
        activities: [
          { name: "Todai-ji", coords: [34.6851, 135.8395], description: "" },
          { name: "Parc aux daims", coords: [34.6850, 135.8443], description: "" },
          { name: "Kasuga Taisha", coords: [34.6863, 135.8497], description: "" },
          { name: "Fushimi Inari", coords: [34.9671, 135.7727], description: "" },
          { name: "Diner et nuit à l'hôtel", coords: null, description: "" }
        ]
      },
      {
        day: "Jour 5 - Vendredi 19 septembre 2025 - Kyoto",
        color: "red",
        activities: [
          { name: "Kinkaku-ji", coords: [35.0394, 135.7292], description: "" },
          { name: "Marché de Nishiki", coords: [35.0042, 135.7651], description: "" },
          { name: "Kiyomizu-dera", coords: [34.9949, 135.7850], description: "" },
          { name: "Ruelles Ninenzaka et Sannenzaka", coords: [34.9946, 135.7840], description: "" },
          { name: "Quartier de Gion", coords: [35.0035, 135.7788], description: "" },
          { name: "Diner et nuit à l'hôtel", coords: null, description: "" }
        ]
      },
      {
        day: "Jour 6 - Samedi 20 septembre 2025 - Kyoto / Amanohashidate",
        color: "red",
        activities: [
          { name: "Temple Nariaiji", coords: [35.5471, 135.2017], description: "" },
          { name: "Observatoire Bentensan", coords: [35.5451, 135.1965], description: "" },
          { name: "Kono-jinja", coords: [35.5540, 135.1970], description: "" },
          { name: "Bateau promenade sur le lagon d’Aso", coords: [35.5561, 135.1990], description: "" },
          { name: "Parc Amanohashidate View Land", coords: [35.5565, 135.1985], description: "" },
          { name: "Diner et nuit à l'hôtel", coords: null, description: "" }
        ]
      },
      {
        day: "Jour 7 - Dimanche 21 septembre 2025 - Amanohashidate / Kanazawa",
        color: "red",
        activities: [
          { name: "Jardin Kenrokuen", coords: [36.5613, 136.6620], description: "" },
          { name: "Higashi-Chaya", coords: [36.572685868533576, 136.66661374032225], description: "" },
          { name: "Maison Shima", coords: [36.5701, 136.6700], description: "" },
          { name: "Diner dans un restaurant local", coords: null, description: "" }
        ]
      },
      {
        day: "Jour 8 - Lundi 22 septembre 2025 - Kanazawa / Shirakawago / Takayama",
        color: "red",
        activities: [
          { name: "Quartier de Nagamachi", coords: [36.5830, 136.6670], description: "" },
          { name: "Maison Nomura", coords: [36.5835, 136.6660], description: "" },
          { name: "Marché Omicho", coords: [36.5657, 136.6593], description: "" },
          { name: "Shirakawago - Observatoire Shiroyama", coords: [36.2600, 136.9000], description: "" },
          { name: "Promenade libre dans Shirakawago", coords: [36.2600, 136.9000], description: "" },
          { name: "Diner dans un restaurant local", coords: null, description: "" }
        ]
      },
      {
        day: "Jour 9 - Mardi 23 septembre 2025 - Takayama / Matsumoto / Kawaguchiko",
        color: "red",
        activities: [
          { name: "Takayama Jinya", coords: [36.1406, 137.2512], description: "" },
          { name: "Vieux quartier et rue Sannomachi", coords: [36.1410, 137.2510], description: "" },
          { name: "Fabrique de miso à Matsumoto", coords: [36.2381, 137.9727], description: "" },
          { name: "Château de Matsumoto", coords: [36.2383, 137.9716], description: "" },
          { name: "Diner et nuit à l'hôtel", coords: null, description: "" }
        ]
      },
      {
        day: "Jour 10 - Mercredi 24 septembre 2025 - Kawaguchiko / Tokyo",
        color: "red",
        activities: [
          { name: "Promenade bord du lac Kawaguchi", coords: [35.5048, 138.7886], description: "" },
          { name: "Croisière sur le lac Kawaguchi", coords: [35.5048, 138.7886], description: "" },
          { name: "Mont Kachi Kachi", coords: [35.5055, 138.7895], description: "" },
          { name: "Quartier d'Asakusa", coords: [35.7148, 139.7967], description: "" },
          { name: "Diner et nuit à l'hôtel", coords: null, description: "" }
        ]
      },
      {
        day: "Jour 11 - Jeudi 25 septembre 2025 - Tokyo",
        color: "red",
        activities: [
          { name: "Mairie de Tokyo", coords: [35.6895, 139.6917], description: "" },
          { name: "Meiji Jingu", coords: [35.6764, 139.6993], description: "" },
          { name: "Harajuku", coords: [35.6701, 139.7021], description: "" },
          { name: "Omotesando", coords: [35.6670, 139.7125], description: "" },
          { name: "Quartier de Shibuya", coords: [35.6580, 139.7016], description: "" },
          { name: "Diner et nuit à l'hôtel", coords: null, description: "" }
        ]
      },
      {
        day: "Jour 12 - Vendredi 26 septembre 2025 - Tokyo / Paris",
        color: "red",
        activities: [
          { name: "Petit-déjeuner et derniers achats", coords: null, description: "" },
          { name: "Transfert à l'aéroport de Tokyo Haneda", coords: null, description: "" },
          { name: "Vol AF 279 pour Paris", coords: null, description: "" }
        ]
      }
    ];

    // ------------------------------
    // 2. Initialiser la carte
    // ------------------------------
    var map = L.map('map').setView([35.68, 139.76], 11); // par défaut Tokyo

    L.tileLayer('https://{s}.tile.jawg.io/jawg-streets/{z}/{x}/{y}.png?access-token=3eaQhPf2daIUX3JcZLPm2YFXBtxgxpRnAhkqY0oIPRdBaOULWnHpKZtEFBd4VlD6', {
      attribution: '&copy; Jawg Maps | &copy; OpenStreetMap contributors',
      subdomains: ['a','b','c'],
      maxZoom: 20
  }).addTo(map);

    map.invalidateSize();

    window.addEventListener('resize', function() {
      map.invalidateSize();
    });

    var markers = [];

    // ------------------------------
    // 3. Générer les markers et popups
    // ------------------------------
    function createIcon(color) {
      return L.icon({
        iconUrl: `https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-${color}.png`,
        shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41]
      });
    }

    itinerary.forEach(day => {
      day.activities.forEach(act => {
        if (act.coords) {
          var marker = L.marker(act.coords, { icon: createIcon(day.color) }).addTo(map)
                        .bindPopup("<b>" + act.name + "</b><br>" + act.description);
          markers.push({ coords: act.coords, marker: marker });
        }
      });
    });

    // ------------------------------
    // 4. Générer le planning dans la colonne
    // ------------------------------
    var planningDiv = document.getElementById("planning");

    itinerary.forEach(day => {
      var dayDiv = document.createElement("div");
      dayDiv.className = "day";

      var dayTitle = document.createElement("h3");
      dayTitle.textContent = day.day;
      dayDiv.appendChild(dayTitle);

      day.activities.forEach(act => {
        var actDiv = document.createElement("div");
        actDiv.className = "activity";
        actDiv.textContent = act.name;
        actDiv.onclick = function() { goTo(act.coords[0], act.coords[1]); };
        dayDiv.appendChild(actDiv);
      });

      planningDiv.appendChild(dayDiv);
    });

    // ------------------------------
    // 5. Fonction pour recentrer + ouvrir popup
    // ------------------------------
    function goTo(lat, lng) {
      map.setView([lat, lng], 15);
      var markerObj = markers.find(m => m.coords[0] === lat && m.coords[1] === lng);
      if(markerObj) markerObj.marker.openPopup();
    }

  </script>
</body>
</html>
